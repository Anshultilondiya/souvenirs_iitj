<script>
  google.script.run.withSuccessHandler(yearbtn)
  .Yearbtn(); // This function call is gets a returned array from Yearbtn and put the returned array in yearbtn function as first variable.
  let LatestFolderId = ' '; // This variable is created for holding Folder Id of first child of ".dropdown-menu" class. 
  // yearbtn Function appends dropdown items in "dropdown-menu" class. These dropdown items are Folders inside "Organised Folder" in drive   
  function yearbtn(returnedArray_from_Yearbtn) {
    const [FolderName, FolderId] = returnedArray_from_Yearbtn;
    for (i = 0; i < FolderName.length; i++) {
      Folder = FolderName[i];
      $(".dropdown-menu").append("<p class ='dropdown-item'" + "id = '" + FolderId[i] + "' onclick = " +
        "FolderCounter('" + FolderId[i] + "')" + ">" + Folder + "</p>");
    };

    LatestFolderId = FolderId[0];
    // Folder Id of first child set into LatestFolderId Variable
    FolderCounter(LatestFolderId);
    // Function call for showing default event folders on home page ("Default Event Folder are the folders inside first child of "dropdown" class") 

    document.getElementById("year_btn").innerHTML = FolderName[0];

  };

  // FolderCounter takes FolderId of Year Folder that is present in dropdown menu.
  // Remove all previously present cards inside cards-holder class.
  // executes CardsDisplay and pass its returned values of CardsDisplay in Show_Folders




  function FolderCounter(FolderId) {
    $(".cards-holder").empty();
    var name = document.getElementById(FolderId).innerHTML;
    document.getElementById("year_btn").innerHTML = name;
    google.script.run.withSuccessHandler(Show_Folders).CardsDisplay(FolderId);
  };

  //Show_Folders Function Appends cards in Album.

  function Show_Folders(returnedArray_from_CardsDisplay) {
    let [FolderName, FolderId] = returnedArray_from_CardsDisplay;
    for (i = 0; i < FolderName.length; i++) {
      Folder = FolderName[i];
      $(".cards-holder").append(
        "<div class='card-warper'>" +
        "<div class='card'>" +
        "<div class='card-body'>" +
        "<div class='card-title'><h3>" + Folder + "</h3></div>" +
        "<div class = 'open-folder-btn'><a href='#header'type='button' class='btn nav-color btn-md'" + "onclick =" +
        "doStuff('" + FolderId[i] + "')" + ">Open Album</a></div></div></div></div>"
      );
    };
  };

  // for breadcrumb
  // These array stores Id and Names of elements inside Breadcrumb

  var Idarray = [];
  var Namearray = [];
  // updateBreadCrumb Function take a array input from getData function in Code.gs
  // First checks whether the clicked folder is present in breadcrumb if ("yes" then it remove all elements and render elements till the name of folder clicked ) else ( appends new element in breadcrumb)
  function updateBreadCrumb(arg) {
    if (Idarray.includes(arg[0])) {

      var ind = Idarray.indexOf(arg[0]);
      Idarray = Idarray.slice(0, ind + 1);
      Namearray = Namearray.slice(0, ind + 1);
      $("#list").empty();
      $("#list").append("<li onclick='gohome()' class='breadcrumb-item'>Home</li>");
      for (i = 0; i < Idarray.length; i++) {
        $("#list").append(
          "<li onclick=" + "doStuff('" + Idarray[i] + "')  class='breadcrumb-item'>" + Namearray[i] + "</li>");
      }

    } else {

      Idarray.push(arg[0]);
      Namearray.push(arg[1]);
      $("#list").empty();
      $("#list").append("<li onclick='gohome()' class='breadcrumb-item'>Home</li>");
      for (i = 0; i < Idarray.length; i++) {
        $("#list").append(
          "<li onclick=" + "doStuff('" + Idarray[i] + "')  class='breadcrumb-item'>" + Namearray[i] + "</li>");
      }

    }

    $("#list li").last().addClass("disabled");
    $("#list li").last().addClass("active");
    document.getElementById("event-after-home").innerHTML = Namearray[0];


  }

  // Adding Functionality to Home element in breadcrumb

  function gohome() {
    $("#Home").removeClass("hide");
    $("#Home").addClass("show");
    $("#header").addClass("header");
    $(".welcome").css("display", "flex");
    $(".navbar-nav").removeClass("nav-color");
    $(".navbar").removeClass("bg-colored");
    $("#nav-logo").css("width", "60px !important");
    $("#Event").css("display", "none");
    $("#form").css("display", "block");
    $("#Albums").css("display", "block");
    $(".fetchedPage").remove();
    $(".FolderView").empty();
    //FolderCounter(LatestFolderId);
    Idarray.length = 0;
    Namearray.length = 0;
    $("#list").empty();
    $("#list").append("<li onclick='gohome()' class='breadcrumb-item active'>Home</li>");
    document.getElementById("event-after-home").innerHTML = '';
    //      $(".header").css("background-image", "url('https://drive.google.com/uc?export=download&id=1e1_S5mjjyM6nhtRyp5MAO4jKf3CSlu3X')");
  }

  //  Adding Functionality to back button

  function goback() {
    var prev = Idarray[Idarray.length - 2];
    if (prev === undefined) {
      $("#Home").removeClass("hide");
      $("#Home").addClass("show");
      $("#header").addClass("header");
      $(".welcome").css("display", "flex");
      $("#nav-logo").css("width", "60px !important");
      $(".navbar-nav").removeClass("nav-color");
      $(".navbar").removeClass("bg-colored");
      $("#Event").css("display", "none");
      $("#form").css("display", "block");
      $("#Albums").css("display", "block");
      $(".fetchedPage").remove();
      $(".FolderView").empty();
      //FolderCounter(LatestFolderId);
      Idarray.length = 0;
      Namearray.length = 0;
      $("#list").empty();
      $("#list").append("<li onclick='gohome()' class='breadcrumb-item active'>Home</li>");
      $("#back_link").attr("href", "#Albums");
      document.getElementById("event-after-home").innerHTML = '';


    } else {
      doStuff(prev.toString());
    }

  }

  // Adding Functionality to Home button on Nav Bar
  $(".home-btn").click(function () {
    $("#Home").removeClass("hide");
    $("#Home").addClass("show");
    $("#header").addClass("header");
    $(".welcome").css("display", "flex");
    $(".navbar-nav").removeClass("nav-color");
    $(".navbar").removeClass("bg-colored");
    $("#nav-logo").css("width", "60px !important");
    $("#Event").css("display", "none");
    $("#form").css("display", "block");
    $("#Albums").css("display", "block");
    $(".fetchedPage").remove();
    $(".FolderView").empty();
    //FolderCounter(LatestFolderId);
    Idarray.length = 0;
    Namearray.length = 0;
    $("#list").empty();
    $("#list").append("<li onclick='gohome()' class='breadcrumb-item active'>Home</li>");
    document.getElementById("event-after-home").innerHTML = '';
    $(".nav-item").removeClass("active");
    $("#home-button").addClass("active");

  });

  // Events btn click on navbar -

  $("#event-btn").click(function () {
    if ($("#Home").hasClass("hide")) {
      $("#Home").removeClass("hide");
      $("#Home").addClass("show");
      $("#header").addClass("header");
      $(".welcome").css("display", "flex");
      $(".navbar-nav").removeClass("nav-color");
      $(".navbar").removeClass("bg-colored");
      $("#nav-logo").css("width", "60px !important");
      $("#Event").css("display", "none");
      $("#form").css("display", "block");
      $("#Albums").css("display", "block");
      $(".fetchedPage").remove();
      $(".FolderView").empty();
      //FolderCounter(LatestFolderId);
      Idarray.length = 0;
      Namearray.length = 0;
      $("#list").empty();
      $("#list").append("<li onclick='gohome()' class='breadcrumb-item active'>Home</li>");
      document.getElementById("event-after-home").innerHTML = '';
      $(".nav-item").removeClass("active");
      $("#event-btn").addClass("active");

    }
  });

  // About btn click on navbar -
  $("#about-btn").click(function () {
    $("#Home").removeClass("hide");
    $("#Home").addClass("show");
    $("#header").addClass("header");
    $(".welcome").css("display", "flex");
    $(".navbar-nav").removeClass("nav-color");
    $(".navbar").removeClass("bg-colored");
    $("#nav-logo").css("width", "60px !important");
    $("#Event").css("display", "none");
    $("#form").css("display", "block");
    $("#Albums").css("display", "block");
    $(".fetchedPage").remove();
    $(".FolderView").empty();
    //FolderCounter(LatestFolderId);
    Idarray.length = 0;
    Namearray.length = 0;
    $("#list").empty();
    $("#list").append("<li onclick='gohome()' class='breadcrumb-item active'>Home</li>");
    document.getElementById("event-after-home").innerHTML = '';
    $(".nav-item").removeClass("active");
    $("#about-btn").addClass("active");
  });


  // webfetch function appends the html content it gets form Websitefetch function from Code.gs
  // This function first removes all previously added elements and then render new.
  // Also perform some changes in styling of fetched html




  function webfetch(content) {
    $(".fetchedPage").remove();
    $(".WebsiteFetch").append("<div class = 'fetchedPage'>" + content + "</div>");
    $(".flip-contents").removeClass("flip-list-view");
    $(".flip-contents").addClass("flip-grid-view");
    $(".flip-entry-list-icon").remove();
    $(".flip-entry-title").remove();
    $(".flip-entry-info a").attr("data-lightbox", "Images");
    imgViewer();
  };


  // doStuff function executes 4 important functions "Checker" and "getData" from Code.gs and "change" and "updateBreadCrumb" and hide home section and show event section if Home has show class already


  function doStuff(FolderId) {
    if ($("#Home").hasClass("show")) {
      $("#Home").removeClass("show");
      $("#Home").addClass("hide");
      $("#header").removeClass("header");
      $(".welcome").css("display", "none");
      $("#nav-logo").css("width", "50px !important");
      $(".navbar-nav").addClass("nav-color");
      $(".navbar").addClass("bg-colored");
      $("#form").css("display", "none");
      $("#Event").css("display", "block");
      $("#Albums").css("display", "none");
    };
    $(".WebsiteFetch").append("<div class='loading-parent text-center'><div class='loading'></div></div>");
    $(".fetchedPage").remove();
    $(".bttn").remove();
    google.script.run.withSuccessHandler(change).Checker(FolderId);
    google.script.run.withSuccessHandler(updateBreadCrumb).getData(FolderId);
  };

  // This function calls webfetch function and executes Websitefetch function from Code.gs if there some files are present in folder.
  // Also this function render folder cards inside Event section


  function change(returnedArray) {

    const [Folders, Files, FoldersId, ParentID] = returnedArray;

    $(".FolderView").empty();
    var embed_url = "https://drive.google.com/embeddedfolderview?id=" + ParentID + "#grid";
    if (Files.length > 0) {
      google.script.run.withSuccessHandler(webfetch).Websitefetch(embed_url);
    };

    if (Files.length == 0) {
      $(".fetchedPage").remove();
      if (Folders.length == 0) {
        $(".FolderView").append(
          "<div class = 'empty-folder'><h1>Empty Folder</h1></div>"
        )
        $(".loading-parent").remove();
      };
    };



    if (Folders.length > 0) {

      for (i = 0; i < Folders.length; i++) {
        Folder = Folders[i];
        $(".FolderView").append(

          "<div class='card-warper bttn show'>" +
          "<div class='card'>" +
          "<div class='card-body'>" +
          "<div class='card-title'><h3>" + Folder + "</h3></div>" +
          "<div class = 'open-folder-btn'><button type='button' class='btn nav-color btn-md'" + "onclick =" +
          "doStuff('" + FoldersId[i] + "')" + ">Open Album</a></div></div></div></div>"

        );
      };
      $(".loading-parent").remove();
    };
  };

  // send mail whenever sheet updates

  function newmail() {
    google.script.run.sendmail();
  }

  // light Box image Viewer

  function imgViewer() {
    var imglist = $(".flip-entry img");
    var lg_imglist = $(".flip-entry-info a");
    for (i = 0; i < imglist.length; i++) {
      var img = imglist[i];
      var lg_img = lg_imglist[i];
      var img_src = $(img).attr("src");
      var img = img_src.split("=");
      img[1] = "=s800";
      var imgEnchance = img[0] + img[1];
      $(lg_img).attr("href", imgEnchance);
      $(".loading-parent").remove();
    }


  }
</script>